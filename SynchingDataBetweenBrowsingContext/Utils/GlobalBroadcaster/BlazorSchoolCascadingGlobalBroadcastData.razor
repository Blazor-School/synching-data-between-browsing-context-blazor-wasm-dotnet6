@using SynchingDataBetweenBrowsingContext.Models
@implements IDisposable
@inject BlazorSchoolGlobalBroadcasterService BlazorSchoolGlobalBroadcasterService

<CascadingValue TValue="BroadcastData<ExampleClass>" Value="_currentData" ChildContent="ChildContent" Name="BlazorSchoolCascadingGlobalBroadcastData" />

@code {
    private BroadcastData<ExampleClass> _currentData = default!;

    [Parameter]
    public RenderFragment ChildContent { get; set; } = _ => { };

    protected override async Task OnInitializedAsync()
    {
        BlazorSchoolGlobalBroadcasterService.OnMessageReceived += OnGlobalBroadcasterNotify;
        await BlazorSchoolGlobalBroadcasterService.ListenChannelAsync();
    }

    public void OnGlobalBroadcasterNotify(object? sender, BroadcastData<ExampleClass> broadcastData)
    {
        _currentData = broadcastData;
        StateHasChanged();
    }

    public void Dispose()
    {
        BlazorSchoolGlobalBroadcasterService.OnMessageReceived -= OnGlobalBroadcasterNotify;
    }
}